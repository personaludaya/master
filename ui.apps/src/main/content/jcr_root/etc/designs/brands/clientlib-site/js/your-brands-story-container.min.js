"use strict";var $=require("jquery"),_=require("underscore");require("magnific-popup");var YourBrandsStoryContainer=function(){function e(){var e=this;this.productInstructionSlideClassName=".js-product-instruction-slide",this.instaImgPrefix="insta",this.instaImgStart=0,this.instaImgLimit=5,this.recentRenderedPos=-1,this.instaFeeds=[],this.endpoint="/dummy-data/data.json",this.timeoutMS=5e3,this.visibleRenderedFeedsIndex=[],this.flipBackTempalate=_.template("<h4><a><%= data.title %></a></h4><p><%= data.description %></p>"),this.staticPos=3,this.titleHashTag="",this.descriptionHashTag="",$(document).ready(function(){e.init(),e.fetchInstaFeeds().then(function(t){e.render(),e.instaFeeds.length>e.instaImgVisisble&&setInterval(function(){e.renderRandomly()},e.timeoutMS),$.ajaxSetup({dataType:"jsonp"});var i='<button style="color: white; position:relative; float: right;" title="Close (Esc)" type="button" class="mfp-close">Ã—</button>',s=$(".flip-front").magnificPopup({type:"ajax",callbacks:{parseAjax:function(e){e&&e.data&&e.data.html&&(e.data=e.data.html)},ajaxContentAdded:function(){if(window.brands.tracker){var e={event:{eventInfo:{eventType:"social_wall",eventName:$(s).attr("data-mfp-src")}}};window.brands.tracker.customTrack(e)}$(".mfp-content").prepend(i),window.instgrm&&window.instgrm.Embeds.process()}}})})})}return e.prototype.activateRandom=function(){var e=this;this.instaFeeds.length>this.instaImgVisisble&&setInterval(function(){e.renderRandomly()},this.timeoutMS)},e.prototype.init=function(){"undefined"!=typeof instaPath&&instaPath&&(this.endpoint=instaPath),$("body").append("<style>.mfp-content { width: 30% !important; } @media (max-width: 767px){ .mfp-content { width: 100% !important; } }</style>"),this.instaImgVisisble=$(".insta-feed-item").length-1},e.prototype.fetchInstaFeeds=function(){var e=this,t=$.Deferred();return $.get(this.endpoint).success(function(i){i&&i.instaFeeds&&i.instaFeeds.instaFeeds&&i.instaFeeds.instaFeeds.length>0?(e.instaFeeds=i.instaFeeds.instaFeeds,e.titleHashTag=i.instaFeeds.title,e.descriptionHashTag=i.instaFeeds.description,t.resolve(!0)):i&&i.instaFeeds&&i.instaFeeds.length>0?(e.instaFeeds=i.instaFeeds,i.title&&(e.titleHashTag=i.title),i.description&&(e.descriptionHashTag=i.description),t.resolve(!0)):t.resolve(!1)}).error(function(e){t.reject(e)}),t.promise()},e.prototype.render=function(){var e=this;$(".insta-feed-item:visible").each(function(t,i){t>=e.instaFeeds.length||!e.instaFeeds[t]||(t!=e.staticPos&&(e.visibleRenderedFeedsIndex.indexOf(t)===-1&&e.visibleRenderedFeedsIndex.push(t),$(i).css("background-image","url("+e.instaFeeds[t].image+")"),$(i).attr({"data-mfp-src":e.instaFeeds[t].url})),$(i).find("div.flip-back").html(e.flipBackTempalate({data:{title:e.titleHashTag,description:e.descriptionHashTag}})))})},e.prototype.renderRandomly=function(){for(var e=-1,t=0;!(e!==-1&&e!==this.recentRenderedPos||t>10);)e=_.random(this.instaImgStart,this.instaImgVisisble),t++;for(var i=-1;i===-1||this.visibleRenderedFeedsIndex.indexOf(i)!==-1;)i=_.random(this.instaImgStart,this.instaFeeds.length-1);$($(".insta-feed-item:visible").get(e)).css("background-image","url("+this.instaFeeds[i].image+")"),$($(".insta-feed-item:visible").get(e)).attr({"data-mfp-src":this.instaFeeds[i].url}),this.visibleRenderedFeedsIndex.push(i),this.visibleRenderedFeedsIndex.length>6&&this.visibleRenderedFeedsIndex.shift(),this.recentRenderedPos=e},e}();exports.YourBrandsStoryContainer=YourBrandsStoryContainer,new YourBrandsStoryContainer;