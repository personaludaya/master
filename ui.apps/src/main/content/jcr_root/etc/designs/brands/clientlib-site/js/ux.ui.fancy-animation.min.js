"use strict";var $=require("jquery"),skrollr=require("skrollr"),_=require("underscore"),Raphael=require("raphael"),UXUIFancyAnime=function(){function t(){this.skrollrNodePos=[],this.heroCanvas=".hero-canvas",this.leftNavBar="leftNavBar",this.opacity=.3,this.leftNavBarOpacity=.7,this.color="#fff",this.duration=1e3,this.startX=10,this.startY=10,this.x=50,this.y=50,this.ANIME_TYPE_HOME_POPULAR_PRODUCT="home--popular-product",this.MILESTONE_RULER=".milestone--toolbar",this.MILESTONE_POINT_INDICATOR_LIST=[],this.MILESTONE_ACTIVE_COLOR="#FF7800",this.init()}return t.prototype.init=function(){var t=this;$(document).ready(function(){$(window).width()>window.brands.tablet_screen&&t.initHeroCanvas()})},t.prototype.initSkrollrIndicatorForHome=function(){var t=this;$(".home--screen1, .home--screen2, .home--screen3, .home--screen4, .home--screen5").each(function(i,e){t.skrollrNodePos.push($(e).offset().top-300)});var i=skrollr.init({forceHeight:!1,render:function(i){var e=_.findIndex(t.skrollrNodePos,function(t){return 0==i.curTop||i.curTop<=t});e>-1?($(".nodes").find(".node").removeClass("active"),e>0&&(e-=1),$($(".nodes").find(".node").get(e)).addClass("active")):($(".nodes").find(".node").removeClass("active"),$(".nodes").find(".node:last-child").addClass("active"))}});i.isMobile()&&(i.destroy(),$(".nodes").remove())},t.prototype.initHeroCanvas=function(){var t=this;if(!($(this.heroCanvas).length<1)){var i=function(){t.MILESTONE_POINT_INDICATOR_LIST=[],setTimeout(function(){t.drawOnCanvas()},1)};$(window).on("resize",i),this.drawOnCanvas()}},t.prototype.drawOnCanvas=function(t){var i=this;if(void 0===t&&(t=""),!($(window).width()<=window.brands.tablet_screen)){t||(t="body"),$(t).find(this.heroCanvas).html("");var e=$(t).find(this.heroCanvas).width(),r=$(t).find(this.heroCanvas).height();Raphael(function(){$(t).find(i.heroCanvas).each(function(t,o){for(var a=Raphael(o),s=[],n=i.startX;n<e;n+=i.x)for(var h=i.startY;h<r;h+=i.y)a.rect(n,h,1,1).attr({stroke:i.color,"stroke-width":2,opacity:i.opacity}),s.push({x:n,y:h});i.drawSimplifiedDots(a,s),i.drawLeftNavBar(a,s),i.drawMilestoneRuler(a,s);var l=[];if($(a.canvas).parent().attr("data-anime-type")==i.ANIME_TYPE_HOME_POPULAR_PRODUCT){for(var c=3,d=3,f=$(window).width()*t-$(a.canvas).parent().parent().find(".product-info-image").offset().left,p=$(a.canvas).parent().parent().find(".product-info-image").offset().top-$(a.canvas).parent().parent().find(".product-info-image").height(),v=_.findIndex(s,function(t){return t.x>=f&&t.y>=p}),y=-1,u=0;u<c;u++)s[v-u]&&s[v-u+y]&&l.push({x:s[v-u].x+i.x*u,y:s[v-u+y].y-i.y*u});for(var u=0;u<d;u++)s[v-u]&&s[v-u+y]&&l.push({x:s[v-u].x-$(a.canvas).parent().parent().find(".product-info-image").width()-i.x*u,y:s[v-u+y].y-i.y*u})}i.drawFancyBoxes(a,s,l)})})}},t.prototype.drawSimplifiedDots=function(t,i){var e=this;if(!($(window).width()<=window.brands.mobile_screen)){var r=(t.set(),300),o=300,a=$(this.heroCanvas).width(),s=($(window).height(),a/2),n=o,h=_.chain(i).shuffle().find(function(t){return t.x>=s&&t.y<=n}).value(),l=[];l.push(h),l.push({x:h.x+r/2,y:h.y+o}),l.push({x:h.x+r,y:h.y/1.5}),l.push({x:h.x,y:h.y+o/2}),l.push({x:h.x+r,y:h.y+o}),l.push({x:h.x+r/2,y:h.y+o/2}),l.push({x:h.x,y:h.y}),l.push({x:h.x+r,y:h.y/1.5}),l.push({x:h.x+2*r,y:h.y+o/3});var c={stroke:this.color,"stroke-width":1,"stroke-opacity":this.opacity,fill:this.color,"fill-rule":"evenodd",opacity:this.opacity,name:"circlegrp"},d={stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.opacity,"stroke-opacity":this.opacity+.5},f=function(i,r){if(l[i]){var o=l[i],a=l[i+1],s=!a;r||t.circle(o.x,o.y,4).attr(c),a&&t.path("M"+o.x+" "+o.y).attr(d).animate({path:"M"+o.x+" "+o.y+" L"+a.x+" "+a.y},2*e.duration,function(){s||f(i+1,r)})}};f(0,!1)}},t.prototype.drawLeftNavBar=function(t,i){var e=this;if(!($(t.canvas).parent().attr("data-anime-type")!=this.ANIME_TYPE_HOME_POPULAR_PRODUCT||$(window).width()<=window.brands.mobile_screen)){var r=t.height/2-27,o=r,a=0,s=a+300+this.startX;if($(window).width()>window.brands.tablet_screen){t.path("M"+a+" "+r+"L"+s+" "+o).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity});t.rect(s-5,o-5,10,10).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity}),t.rect(s-2,o-2,3,3).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity}),o=r+$(".leftNavBar").height()/2+50,a=s,s=a;t.path("M"+a+" "+r+"L"+s+" "+o).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity});t.rect(s-1,o,3,3).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity}),r=r+$(".leftNavBar").height()+50,o=r,a=0,s=a+150+this.startX;t.path("M"+a+" "+r+"L"+s+" "+o).attr({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:this.leftNavBarOpacity,"stroke-opacity":this.leftNavBarOpacity})}var n=_.findIndex(i,function(t){return t.x>=s&&t.y>=o-e.y});if(n>-1){for(var h=[],l=i[n].x+this.x,c=0;c<3;c++)i[n]&&h.push({x:l+this.x*c,y:i[n].y-this.y*c});this.drawFancyBoxes(t,i,h)}var d=$(".leftNavBar").find("li").length;r=t.height/2-27+5+3*$(".leftNavBar").find("h5").height();var f=[],p=function(i,r,o,a,s){var n={stroke:e.color,"stroke-linecap":"square","stroke-width":1,fill:e.color,"fill-rule":"evenodd",opacity:0,"stroke-opacity":0},h={path:"M"+i+" "+r+"L"+o+" "+a,opacity:e.leftNavBarOpacity,"stroke-opacity":e.leftNavBarOpacity},l=t.path("M"+i+" "+r).attr(n).animate(h,e.duration,function(){s+1<d&&(r+=35,a=r,p(i,r,o,a,s+1))});f.push(l)},v=function(){setTimeout(function(){if($(".leftNavBar").find("h5").css("opacity")>0){var t=0;o=r,a=0,s=a+45,p(a,r,s,o,t)}else v()},e.duration/3)};v()}},t.prototype.drawFancyBoxes=function(t,i,e){var r=this;e||(e=[]);var o=3,a=50,s=50,n=!1,h=(_.random(10,$(this.heroCanvas).width()),_.random(10,$(this.heroCanvas).height()));h<250&&(h+=250);({stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:.5,"stroke-opacity":.5});if(e.length<1)for(var l=0;l<o;l++){var c=_.random(0,i.length);i[c]&&e.push({x:i[c].x,y:i[c].y})}else n=!0;for(var d=function(i,e){var o=t.rect(i.x,i.y,a,s).attr({fill:r.color,stroke:r.color,"stroke-width":0,opacity:0}).animate({opacity:.1},n?r.duration*e*2:r.duration,function(){n&&(o.remove(),d(i,e))})},f=1,p=0,v=e;p<v.length;p++){var y=v[p];d(y,f),f++}},t.prototype.drawMilestoneRuler=function(t,i){if(!($(this.MILESTONE_RULER).length<1||this.MILESTONE_POINT_INDICATOR_LIST.length>0)){var e=this,r=0,o=$(this.MILESTONE_RULER).offset().top-($(window).width()<=window.brands.mobile_screen?120:70),a=$(this.heroCanvas).width(),s=[],n=-1;$(this.MILESTONE_RULER).find("li").each(function(t,i){$(i).hasClass("active")&&(n=t),s.push($(i).offset().left+$(i).width()/2-t)});var h={stroke:this.color,"stroke-linecap":"square","stroke-width":1,fill:this.color,"fill-rule":"evenodd",opacity:1,"stroke-opacity":1};$(window).width()<=window.brands.mobile_screen&&(r=$(".swiper-milestone-prev").offset().left+2*$(".swiper-milestone-prev").width(),a=$(".swiper-milestone-next").offset().left+.2*$(".swiper-milestone-next").width()),t.path("M"+r+" "+o+" L"+a+" "+o).attr(h);for(var l=0,c=function(i){var r=!1,a=o+25;h.stroke=d.color,h["stroke-width"]=1,h.opacity=1,$(window).width()<=window.brands.mobile_screen&&(i<$(".swiper-milestone-prev").offset().left+2*$(".swiper-milestone-prev").width()||i>$(".swiper-milestone-next").offset().left+.2*$(".swiper-milestone-next").width())&&(h.opacity=.3),_.findIndex(s,function(t){return t+5<=i&&t-5<=i})>-1&&(l==n&&(h.stroke=d.MILESTONE_ACTIVE_COLOR,h["stroke-width"]=2),a=o+35,s.splice(0,1),l++,r=!0);var c=t.path("M"+i+" "+(o+5)+" L"+i+" "+a).attr(h);r&&e.MILESTONE_POINT_INDICATOR_LIST.push(c)},d=this,f=0;f<a;f+=5)c(f)}},t.prototype.changeActiveMilestonePointIndicator=function(t){for(var i=0;i<this.MILESTONE_POINT_INDICATOR_LIST.length;i++)this.MILESTONE_POINT_INDICATOR_LIST[i].attr({stroke:t==i?this.MILESTONE_ACTIVE_COLOR:this.color,"stroke-width":2})},t}();window.brands.anime=new UXUIFancyAnime;