"use strict";var $=require("jquery"),shared_1=require("./shared"),productTemplate=require("product-container-partial"),Swiper=require("swiper"),_=require("underscore"),OurProductToolbarAndContainer=function(){function e(){this.wrapperClassName=".js-product-container-wrapper",this.swiperSlideClassName=".js-toolbar-container",this.maxAllowedSelection=2,this.ourProductEndPoint="/dummy-data/data.json",this.loader=new shared_1.Loader,this.clearAll="#clearall",this.applylifestagesfilter="#applylifestagesfilter",this.utils=new shared_1.Utils,this.selectedFilterIds=[],this.ourProductBannerItemSelector=".our-product-banner-item",this.init()}return e.prototype.init=function(){var e=this;"undefined"!=typeof prodCategoryPath&&prodCategoryPath&&(this.ourProductEndPoint=prodCategoryPath);var t=this;this.render(!1).then(function(r){$(e.wrapperClassName).html(r).promise().done(function(){t.postRender(r)})}),$(document).ready(function(){$(".js-toolbar-container li").each(function(e,r){$(this).on("click",function(e){if($(r).hasClass("active")===!1){if($(".js-toolbar-container li.active").length>=t.maxAllowedSelection)return;$(r).addClass("active"),$(r).find(".brands-icon").length>0&&($(r).find(".brands-icon use").attr("href").indexOf("icon-active-people-primary")>-1?($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-active-people-primary","icon-active-people-secondary")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-active-people-primary","icon-active-people-secondary"))):$(r).find(".brands-icon use").attr("href").indexOf("icon-busy-adult")>-1?($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-busy-adult","icon-busy-adult-secondary")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-busy-adult","icon-busy-adult-secondary"))):$(r).find(".brands-icon use").attr("href").indexOf("icon-student-primary")>-1&&($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-student-primary","icon-student-secondary")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-student-primary","icon-student-secondary")))),t.selectedFilterIds.push($(r).attr("data-id").trim())}else $(r).removeClass("active"),$(r).find(".brands-icon").length>0&&($(r).find(".brands-icon use").attr("href").indexOf("icon-active-people-secondary")>-1?($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-active-people-secondary","icon-active-people-primary")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-active-people-secondary","icon-active-people-primary"))):$(r).find(".brands-icon use").attr("href").indexOf("icon-busy-adult-secondary")>-1?($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-busy-adult-secondary","icon-busy-adult")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-busy-adult-secondary","icon-busy-adult"))):$(r).find(".brands-icon use").attr("href").indexOf("icon-student-secondary")>-1&&($(r).find(".brands-icon use").attr("href",$(r).find(".brands-icon use").attr("href").replace("icon-student-secondary","icon-student-primary")),$(r).find(".brands-icon use").attr("xlink:href",$(r).find(".brands-icon use").attr("xlink:href").replace("icon-student-secondary","icon-student-primary")))),t.selectedFilterIds.splice(t.selectedFilterIds.indexOf($(r).attr("data-id").trim()),1)})}),$(e.clearAll).on("click",function(){$(".js-toolbar-container li.active").removeClass("active"),e.selectedFilterIds=[],$(e.applylifestagesfilter).trigger("click")}),$(e.applylifestagesfilter).off().on("click",function(r){if(window.brands.tracker&&window.brands.tracker.trackLifestagesFilter){var i=[];$(".js-toolbar-container li.active").each(function(e,t){i.push($(t).attr("data-id").trim())}),i.length>0&&window.brands.tracker.trackLifestagesFilter(i.join("|"))}t.render(t.selectedFilterIds.join(",")).then(function(r){$(t.wrapperClassName).html(r).promise().done(function(){t.postRender(r,t.selectedFilterIds.join(",")),$(e.wrapperClassName).append("<script>window['brands'].ourProductFunc(false);</script>")})})}),new Swiper(e.swiperSlideClassName,{loop:!1,slidesPerView:7,paginationClickable:!0,centeredSlides:!1,spaceBetween:2,nextButton:".swiper-lifestages-next",prevButton:".swiper-lifestages-prev",breakpoints:{1500:{slidesPerView:6},1200:{slidesPerView:4},1100:{slidesPerView:3},767:{slidesPerView:2}},onSlideChangeEnd:function(e){window.brands.tracker&&window.brands.tracker.trackCarousel(e)}}),e.utils.rebindHeaderAndFooterLinksWithoutHash()})},e.prototype.postRender=function(e,t){var r=this;if(void 0===t&&(t=!1),t){var i=t.split(",");$.each(i,function(e,t){$("ul.product-benefits li").each(function(e,r){var i=$(r).data("id");i==t&&$(r).addClass("selected-life-stage")})})}$(".product-row-wrapper").each(function(){$(this).find(".product-col-wrapper.hidden-xs").first().removeClass("hidden-xs")}),$(".product-container .view-all").each(function(e,t){var i=$(t).parent().parent().parent().parent().parent().find(".product-row-wrapper").children().length;1==i&&$(t).hide(),$(r).find("span").text($(r).closest(".product-container").find(".product-row-wrapper .product-col-wrapper").length)}),$(".product-container .view-all").click(function(){if($(this).closest(".product-container").find(".product-col-wrapper").hasClass("hidden-xs"))$(this).closest(".product-container").find(".product-col-wrapper").removeClass("hidden-xs"),$(this).closest(".view-all").text($(this).closest(".view-all").attr("data-hide-all-text"));else{$(this).closest(".product-container").find(".product-col-wrapper").addClass("hidden-xs"),$(this).closest(".product-container").find(".product-col-wrapper").first().removeClass("hidden-xs");$(this).closest(".product-container").find(".product-info-overview").length;$(this).closest(".view-all").text($(this).closest(".view-all").attr("data-view-all-text")),$("html, body").animate({scrollTop:$(this).closest(".product-container").find(".product-col-wrapper").first().offset().top-100},500)}}),$(window).width()<=window.brands.mobile_screen,this.utils.bindProductComparison(),window.brands.ourProductFunc||(window.brands.ourProductFunc=function(e){r.utils.productOverviewButtonAlignmentEqualizer(function(){if(location.hash&&e)for(var t=location.hash.split(","),i=0;i<t.length;i++){var n=t[i].split("=");n&&n.length>1?"profile"==n[0].replace("#","")&&$('.js-toolbar-container li[data-id="'+n[1]+'"]').length>0&&($('.js-toolbar-container li[data-id="'+n[1]+'"]').addClass("active"),r.selectedFilterIds.push($('.js-toolbar-container li[data-id="'+n[1]+'"]').attr("data-id").trim()),$(r.applylifestagesfilter).trigger("click"),$(document.body).animate({scrollTop:$(r.swiperSlideClassName).offset().top},600)):0==i&&t[i].indexOf("=")<0&&$(document.body).animate({scrollTop:$(t[0]).offset().top},600)}})},$(this.wrapperClassName).append("<script>window['brands'].ourProductFunc(true);</script>")),$(".product-container a").on("click",function(e){window.brands.tracker&&$(e.currentTarget).attr(window.brands.tracker.dataAnalyticsAttr)&&window.brands.tracker.customTrack($(e.currentTarget).attr(window.brands.tracker.dataAnalyticsAttr))}),$(window).resize(function(){r.utils.productOverviewButtonAlignmentEqualizer()})},e.prototype.render=function(e){var t=this;this.loader.show(this.wrapperClassName);var r="",i=$.Deferred();return e?"undefined"!=typeof prodFilterResultPath&&prodFilterResultPath&&(this.ourProductEndPoint=prodFilterResultPath+"?filter="+e):"undefined"!=typeof prodCategoryPath&&prodCategoryPath&&(this.ourProductEndPoint=prodCategoryPath),$.get(this.ourProductEndPoint).success(function(e){for(var n=_.chain(_.clone(e.ourProducts)).groupBy("title").map(function(e){for(var t={title:"",categoryid:"",eccategoryid:"",tiles:[]},r=[],i=0;i<e.length;i++)t.title=e[i].title,t.categoryid=e[i].categoryid,t.eccategoryid=e[i].eccategoryid,"ads"!=e[i].tiles[0].type||3!=e[i].pos&&6!=e[i].pos&&9!=e[i].pos?t.tiles.push(e[i].tiles[0]):r.push({pos:e[i].pos,tiles:e[i].tiles[0]});for(var i=0;i<r.length;i++)t.tiles.splice(r[i].pos-1,0,r[i].tiles);return t}).value(),a=0,o=n;a<o.length;a++){var s=o[a];r+=productTemplate.template({view_all_label:!!e.labels&&e.labels.viewall,hide_all_label:!!e.labels&&e.labels.hideall,selectedLifeStages:t.selectedFilterIds,title:s.title,categoryid:s.categoryid,eccategoryid:s.eccategoryid,tileList:s.tiles,arrowDown:window.brands.icons.arrowDown,arrowUp:window.brands.icons.arrowUp})}t.loader.hide(t.wrapperClassName),i.resolve(r)}).error(function(e){t.loader.hide(t.wrapperClassName),i.reject(e)}),i.promise()},e}();exports.OurProductToolbarAndContainer=OurProductToolbarAndContainer,new OurProductToolbarAndContainer;